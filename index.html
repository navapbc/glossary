
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- <link rel="icon" href="../../favicon.ico"> -->

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css"/>
    <style type="text/css">
      .dataTables_wrapper .dataTables_filter {
        float: left;
      }
    </style>

    <title>Glossary</title>
  </head>

  <body>
    <div class="container">
      <div>
        <h1>Glossary</h1>
        <p>Add or update term definitions <a href="https://docs.google.com/spreadsheets/d/1KIAxNf7yHRTMumP9IderxbL4M0X40b4NxDbN4LU2j94/edit" target="_blank">here</a>.</p>
        <div class="table-container"></div>
      </div>
    </div><!-- /.container -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.11.1/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.5/bluebird.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>

    <!-- <script type="text/javascript" src="https://cdn.datatables.net/t/bs/dt-1.10.11/datatables.min.js"></script> -->
    <script type="text/javascript">
      (function() {
        var sheetId = '1KIAxNf7yHRTMumP9IderxbL4M0X40b4NxDbN4LU2j94';
        var url = 'https://spreadsheets.google.com/feeds/list/' + sheetId + '/1/public/basic?alt=json';

        function getData() {
          return new Promise(function(resolve, reject) {
            $.ajax({
              url: url,
              type: 'GET',
              success: function(data) {
                resolve(_.map(data.feed.entry, function(row) {
                  return {
                    term: row.title.$t,
                    description: row.content.$t.substr('description: '.length)
                  };
                }));
              },
              error: reject
            });
          });
        }

        function renderTable(rows) {
          var $table = $('<table>')
            .append($('<thead>')
              .append($('<tr>')
                .append($('<th>').text('Term'))
                .append($('<th>').text('Description'))))
            .append($('<tbody>')
              .append(_.map(rows, renderRow)));

          return $table;
        }

        function renderRow(row) {
          return $('<tr>')
            .append($('<td>').text(row.term))
            .append($('<td>').text(row.description));
        }

        function updateHash() {
          var query = $('.table-container input').val();
          window.location.hash = query.replace(/\s+/g, '-').toLowerCase();
        }

        $(document).ready(function(){
          getData()
            .then(function(data) {
              var $table = renderTable(data);
              $table.appendTo($('.table-container'));

              var dataTable = $table.DataTable({
                pageLength: 100,
                lengthChange: false, // disables ability to change number of items per page
                columns: [
                  null,
                  { "searchable": false }
                ]
              });

              // queries with the current hash if there is one
              var hash = window.location.hash.substring(1);
              if (hash.length) {
                // hashes are slugged '#waiting-room'
                var query = hash.replace(/-/g, ' ');

                // https://datatables.net/reference/api/search()
                dataTable.search(query).draw();
              }

              // update the hash whenever the table is rerendered
              $table.on('draw.dt', updateHash);
            });
        });
      })();
    </script>
  </body>
</html>